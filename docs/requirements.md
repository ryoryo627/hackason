# 要件定義書 v3

**HomeCare AI Agent — 在宅医療支援AIエージェント**

| 項目 | 内容 |
|------|------|
| 文書ID | HCAI-REQ-003 |
| バージョン | 3.0 |
| 作成日 | 2026-02-05 |
| 対象 | GCP AI Hackathon Vol.4 |

---

## 1. 背景と課題

在宅医療では医師・訪問看護師・薬剤師・ケアマネジャー・家族など多職種が1人の患者に関わる。しかし情報共有はFAX・連絡ノート・電話が主流であり、以下の課題が存在する。

- **情報の散逸**: 各職種が断片的な情報しか持たず、患者の全体像が見えない
- **オンコール時の情報不足**: 夜間当直医が患者の最近の状態を迅速に把握できない
- **能動的分析の欠如**: 複数職種からの報告を横断分析して異変パターンを検知する仕組みがない
- **既存ICTの限界**: MCS・バイタルリンク・TRITRUS等は受動的情報共有のみ。AIによる臨床推論機能なし
- **導入・運用の障壁**: 新システム導入のたびに事務スタッフの負担増大、定着しない

## 2. ソリューション概要

Slackを患者ごとの情報集約ハブとし、Google Cloud上のAIエージェント群（ADK）が多職種からの報告をBio-Psycho-Social（BPS）フレームワークで構造化・蓄積・分析する。

差別化3点:
1. **能動的AI臨床推論**: Alert Agentが複数職種×時系列データを横断分析し、異変パターンを自動検知
2. **ゼロコンフィグ運用**: Admin UIから患者登録するだけでSlackチャンネル作成・Bot設定・メンバー招待まで全自動
3. **RAGナレッジベース**: 診療ガイドライン・BPSモデル理論・院内プロトコルで臨床推論を強化。Admin UIから管理・チューニング可能

## 3. 競合分析

| 比較軸 | 既存ICT（MCS等） | AI活用（iBow等） | 本システム |
|--------|-------------------|-------------------|------------|
| 情報共有 | ○ 受動的 | ○ 単一職種内 | **◎ 多職種統合** |
| AI分析 | × | △ 書類作成のみ | **◎ BPS横断臨床推論** |
| リアルタイムアラート | × | × | **◎ 能動的異変検知** |
| ナレッジベース | × | × | **◎ RAG + カテゴリバインド** |
| 導入容易性 | △ 専用システム | △ 専用システム | **◎ Slack + WebUI** |

## 4. ユーザーペルソナ

| ペルソナ | 主な操作 | インターフェース |
|----------|---------|------------------|
| 事務スタッフ | セットアップ、患者登録、マスタ管理 | Admin UI |
| 訪問看護師 | 訪問報告入力（テキスト/PDF/画像） | Slack |
| 薬剤師 | 服薬状況報告 | Slack |
| ケアマネジャー | 介護サービス・家族情報共有 | Slack |
| 主治医 | 患者状態の俯瞰、エクスポート、ナレッジ管理 | Slack + Admin UI |
| 当直医 | サマリー取得、アラート確認 | Slack |

## 5. ユースケース

**UC-1: 組織への初期導入** — セットアップウィザード4ステップ（Slack App作成ガイド→トークン入力→接続テスト→自動初期設定）

**UC-2: 新規患者登録** — Admin UI 3ステップフォーム（基本情報→所属タグ→担当者）→ 登録ボタン1つで全自動（Firestore書込→Slackチャンネル作成→Bot参加→アンカーメッセージ→メンバー招待）

**UC-3: 訪問報告の入力** — Slackで患者チャンネルのBotにリプライ → Intake AgentがBPS構造化 → Firestore保存 → Alert Agent即時検知

**UC-4: オンコール引き継ぎ** — `@bot サマリー` → Summary AgentがBPS経過サマリー生成

**UC-5: 朝8時定時レポート** — Cloud Scheduler → Alert Agentが全患者スキャン → `#oncall-night`に状態変化レポート投稿

**UC-6: Admin UIでの確認・エクスポート** — 検索・フィルタ → 患者詳細（BPSサマリー・タイムライン・推奨事項）→ 3形式エクスポート

**UC-7: ナレッジベース管理** — ドキュメント追加（PDF/MD/URL）→ チャンク確認 → 検索テスト → エージェント別カテゴリバインド

**UC-8: API設定・モニタリング** — サービス別キー管理 → 接続テスト → 使用量確認 → セキュリティチェック

## 6. 実装状況サマリー

### Phase 1: 基盤構築 ✅ 完了
- ✅ M-1: Firestoreデータモデル + デモデータ
- ✅ M-2: FastAPI基本構造 + Cloud Run
- ✅ M-3: Firebase Auth + ログイン画面
- ✅ M-4: Admin UIフレームワーク

### Phase 2: セットアップ＋患者登録 ✅ 完了
- ✅ M-5: セットアップウィザード
- ✅ M-6: 患者登録 + Slack自動連携
- ✅ M-7: API & サービス設定画面

### Phase 3: Slack Bot＋AIエージェント ✅ 完了
- ✅ M-8: Slack Bot基本機能
- ✅ M-9: Intake Agent
- ✅ M-10: Context Agent
- ✅ M-11: Alert Agent
- ✅ M-12: Summary Agent

### Phase 4: ダッシュボード＋一覧＋詳細 ✅ 完了
- ✅ M-13: ダッシュボード
- ✅ M-14: 患者一覧
- ✅ M-15: 患者詳細
- ✅ M-16: アラート一覧・詳細

### Phase 5: RAG＋定時タスク＋仕上げ ✅ 完了
- ✅ M-17: RAGナレッジベース（CRUD + Embedding検索実装完了 — Firestore + text-embedding-005 + cosine similarity）
- ✅ M-18: 定時タスク（エンドポイント + cron認証実装済み、Cloud Scheduler設定手順確定）
- ✅ M-19: デプロイ + デモデータ整備
- ✅ マスタ管理・組織設定画面
- ✅ AIエージェント設定画面（カスタムプロンプト管理）
- ✅ CSVインポート・一括メンバー割当
- ✅ 患者削除・エクスポート機能

---

## 7. 機能要件サマリー

### 7.1 Admin UI（14ルート）

| 画面 | 説明 | 詳細参照 |
|------|------|---------|
| ログイン | Firebase Auth（メール+パスワード / Google） | ui-ux-design.md |
| セットアップウィザード | Slack連携初期設定（4ステップ・初回のみ） | ui-ux-design.md |
| ダッシュボード | 統計・要対応アラート・接続状態・最近の報告・朝レポート | ui-ux-design.md |
| 患者一覧 | 検索・フィルタ6種・ソート4種・グループ表示 | ui-ux-design.md |
| 患者登録 | 3ステップフォーム → 自動Slack連携（モーダル） | ui-ux-design.md |
| 患者詳細 | BPSサマリー・タイムライン・推奨事項・アラート履歴・エクスポート | ui-ux-design.md |
| 患者情報編集 | 基本情報・タグ編集（モーダル） | ui-ux-design.md |
| アラート一覧 | 緊急度・確認状態フィルタ | ui-ux-design.md |
| アラート詳細 | 根拠報告・推奨アクション・確認操作（モーダル） | ui-ux-design.md |
| ナレッジベース | 概要・ドキュメント管理・チャンク確認・検索テスト・エージェント連携 | ui-ux-design.md |
| ナレッジ追加 | PDF/MD/URL追加・チャンク設定（モーダル） | ui-ux-design.md |
| API & サービス設定 | 接続状況・サービス設定・使用量・セキュリティ | ui-ux-design.md |
| マスタ管理 | 事業所・地区・タグのCRUD | ui-ux-design.md |
| 組織設定 | 組織情報・メンバー管理・ロール設定 | ui-ux-design.md |

### 7.2 Slack Bot

- チャンネル構成: `#oncall-night` + `#pt-{患者名}`
- 3モードインタラクション: コンテキスト蓄積（Botリプライ）、カジュアルチャット（直接投稿）、AI相談（@bot）
- 詳細: `slack-bot-design.md`

### 7.3 AIエージェント（ADK）

- BaseAgent共通基底 + 4サブエージェント: Intake / Context / Alert / Summary
- RAGナレッジベース: 8カテゴリ、エージェント別バインド
- 詳細: `agent-design.md`

### 7.4 バックエンドAPI

- 患者CRUD + Slack自動連携
- セットアップ + 接続テスト
- ナレッジCRUD + 検索テスト
- サービス設定CRUD
- エクスポート
- 詳細: `api-design.md`

## 8. 非機能要件

| ID | カテゴリ | 要件 |
|----|---------|------|
| NFR-1 | パフォーマンス | Slack Bot応答: 10秒以内 |
| NFR-2 | パフォーマンス | Admin UI初期ロード: 3秒以内 |
| NFR-3 | パフォーマンス | 患者登録（全自動完了）: 5秒以内 |
| NFR-4 | スケーラビリティ | 100名以上の患者管理を想定した設計 |
| NFR-5 | セキュリティ | Firebase Authentication（Admin UI） |
| NFR-6 | セキュリティ | Firestore service_configs（APIキー一元管理） |
| NFR-7 | セキュリティ | Slackリクエスト署名検証 |
| NFR-8 | セキュリティ | Firestoreの組織スコープACL |
| NFR-9 | セキュリティ | 患者データの保存時暗号化（GCPデフォルト） |
| NFR-10 | 可用性 | Cloud Run自動スケーリング |
| NFR-11 | 運用性 | Cloud Loggingによるログ集約 |
| NFR-12 | デモ | 模擬患者24名以上のデータ |

## 9. MVP実装スコープ

### 必須タスク（推定50h）

| ID | 機能 | 工数 |
|----|------|------|
| M-1 | Firestoreデータモデル + デモデータ | 3h |
| M-2 | FastAPI基本構造 + Cloud Run | 2h |
| M-3 | Firebase Auth + ログイン画面 | 2h |
| M-4 | Admin UIフレームワーク（サイドバー+ルーティング） | 3h |
| M-5 | セットアップウィザード（4ステップ） | 4h |
| M-6 | 患者登録フォーム + Slack自動連携API | 5h |
| M-7 | API & サービス設定画面 | 3h |
| M-8 | Slack Bot基本機能（Events API受信・署名検証） | 3h |
| M-9 | Intake Agent（テキスト + PDF + 画像） | 5h |
| M-10 | Context Agent | 3h |
| M-11 | Alert Agent（即時検知） | 4h |
| M-12 | Summary Agent | 3h |
| M-13 | ダッシュボード | 3h |
| M-14 | 患者一覧（検索・フィルタ） | 3h |
| M-15 | 患者詳細（BPS・タイムライン・推奨・エクスポート） | 3h |
| M-16 | アラート一覧・詳細 | 2h |
| M-17 | RAGナレッジベース（管理+検索+エージェント連携） | 5h |
| M-18 | 定時タスク（朝8時スキャン） | 2h |
| M-19 | デプロイ + デモデータ整備 | 3h |

### MVP拡張（時間があれば）

- マスタ管理画面（事業所・地区・タグCRUD）
- 組織設定画面（メンバー管理・ロール）
- 患者アーカイブ機能
- 使用量モニタリング（コスト表示）
- キーローテーション機能

## 10. ハッカソン提出物

| 提出物 | 要件 |
|--------|------|
| GitHubリポジトリ | 公開。README + 設計ドキュメント + ソースコード |
| デプロイURL | Cloud Run上の動作アプリ |
| Zenn記事 | 開発過程・技術選定・アーキテクチャ |
| デモ動画（3分） | 7シーン構成（課題→セットアップ→報告→アラート→サマリー→AdminUI→まとめ） |

## 11. 審査基準への適合

| 審査基準 | 適合内容 |
|---------|---------|
| 課題の新規性 | 多職種連携×AI臨床推論は国内外で未開拓 |
| 解決策の有効性 | BPS構造化、マルチエージェント、RAGナレッジ、リアルタイムアラート |
| 技術的実装 | ADK + Gemini + Cloud Run + Firestore + Vertex AI Vector Search |
| 拡張性 | マルチエージェント設計、Firestoreスキーマレス、RAGカテゴリ拡張 |
| UX・実用性 | ゼロコンフィグ運用、100名対応検索、3形式エクスポート |
